<div class="container">
  <h1 class="title">SysAdmin by Domain</h1>
</div>
<mat-card class="table-container">
  <div class="dropdown-container">
    <mat-form-field appearance="fill" style="width: 500px;">
      <mat-label>Select domain</mat-label>
      <mat-select [(value)]="selected_domain" (selectionChange)="onChange($event)">
        <mat-option *ngFor="let domain of domains | keyvalue" [value]="domain.value">
          <span>{{ domain.value.name }} [{{ domain.value.domainId }}] 
            <span *ngFor="let env of domain.value.environments;let i = index">
              <span *ngIf="env && i==0" style="background-color: #f5a82a; margin-right: 5px; color: white;"> Dev </span>
              <span *ngIf="env && i==1" style="background-color: #c125f2; margin-right: 5px; color: white;"> Preprod </span>
              <span *ngIf="env && i==2" style="background-color: #4557a2; margin-right: 5px; color: white;"> Prod </span>
              <span *ngIf="env && i==3" style="background-color: #50c63e; margin-right: 5px; color: white;"> Test </span>
              <span *ngIf="env && i==4" style="background-color: #956248; margin-right: 5px; color: white;"> ProdCopy </span>
              <span *ngIf="env && i==5" style="background-color: #f5f334; margin-right: 5px; color: white;"> Staging </span>
            </span>
          </span>
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <mat-card-content>
    <table matSort mat-table [dataSource]="data_source">
      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef>
          <div *ngIf="show_add">
            <button mat-raised-button color="primary" (click)="addSysAdmin(element)" style="margin: 8px 8px 8px 0;">Add</button>
          </div>
          <div *ngIf="!show_add">
            <button mat-raised-button class="color-button" (click)="saveSysAdmin()" style="margin: 8px 8px 8px 0;">Save</button>
            <button mat-raised-button color="primary" (click)="cancelSysAdmin()" style="margin: 8px 8px 8px 0;">Cancel</button>
          </div>
        </th>
        <td mat-cell *matCellDef="let element"> {{element[1]}} </td>
      </ng-container>

      <ng-container matColumnDef="dev">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <input type="checkbox" [(ngModel)]="one_checked[1]" (change)="one_checked[1] ? checkAll(1) : uncheckAll(1)">
          <div style="margin: 5px; background-color: #f5a82a; color: white; padding: 3px;">Dev</div>
        </th>
        <td mat-cell *matCellDef="let element" style="text-align: center;"> 
          <ng-container *ngIf="element[2]">
            <ng-container *ngIf="isModified(element[0],1)">
              <mat-button color="primary" (click)="check(element[0],1)">
                <mat-icon>calendar_month</mat-icon>
              </mat-button>
            </ng-container>
            <input type="checkbox" [(ngModel)]="element[2]" (change)="uncheck(element[0],1)">
          </ng-container>
          <ng-container *ngIf="!element[2]">
            <input type="checkbox" [(ngModel)]="element[2]" (change)="check(element[0],1)">
          </ng-container>   
        </td>
      </ng-container>

      <ng-container matColumnDef="preprod">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> 
          <input type="checkbox" [(ngModel)]="one_checked[2]" (change)="one_checked[2] ? checkAll(2) : uncheckAll(2)">
          <div style="margin: 5px; background-color: #c125f2; color: white; padding: 3px;">Preprod</div>
        </th>
        <td mat-cell *matCellDef="let element" style="text-align: center;"> 
          <ng-container *ngIf="element[3]">
            <ng-container *ngIf="isModified(element[0],2)">
              <mat-button color="primary" (click)="check(element[0],2)">
                <mat-icon>calendar_month</mat-icon>
              </mat-button>
            </ng-container>
            <input type="checkbox" [(ngModel)]="element[3]" (change)="uncheck(element[0],2)">
          </ng-container>
          <ng-container *ngIf="!element[3]">
            <input type="checkbox" [(ngModel)]="element[3]" (change)="check(element[0],2)">   
          </ng-container>  
        </td>
      </ng-container>

      <ng-container matColumnDef="prod">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <input type="checkbox" [(ngModel)]="one_checked[3]" (change)="one_checked[3] ? checkAll(3) : uncheckAll(3)">
          <div style="margin: 5px; background-color: #4557a2; color: white; padding: 3px;">Prod</div>
        </th>
        <td mat-cell *matCellDef="let element" style="text-align: center;"> 
          <ng-container *ngIf="element[4]">
            <ng-container *ngIf="isModified(element[0],3)">
              <mat-button color="primary" (click)="check(element[0],3)">
                <mat-icon>calendar_month</mat-icon>
              </mat-button>
            </ng-container>
            <input type="checkbox" [(ngModel)]="element[4]" (change)="uncheck(element[0],3)">
          </ng-container>
          <ng-container *ngIf="!element[4]">
            <input type="checkbox" [(ngModel)]="element[4]" (change)="check(element[0],3)">   
          </ng-container>
        </td>
      </ng-container>

      <ng-container matColumnDef="test">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <input type="checkbox" [(ngModel)]="one_checked[4]" (change)="one_checked[4] ? checkAll(4) : uncheckAll(4)">
          <div style="margin: 5px; background-color: #50c63e; color: white; padding: 3px;">Test</div>
        </th>
        <td mat-cell *matCellDef="let element" style="text-align: center;"> 
          <ng-container *ngIf="element[5]">
            <ng-container *ngIf="isModified(element[0],4)">
              <mat-button color="primary" (click)="check(element[0],4)">
                <mat-icon>calendar_month</mat-icon>
              </mat-button>
            </ng-container>
            <input type="checkbox" [(ngModel)]="element[5]" (change)="uncheck(element[0],4)">
          </ng-container>
          <ng-container *ngIf="!element[5]">
            <input type="checkbox" [(ngModel)]="element[5]" (change)="check(element[0],4)">   
          </ng-container>    
        </td>
      </ng-container>

      <ng-container matColumnDef="prodCopy">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <input type="checkbox" [(ngModel)]="one_checked[5]" (change)="one_checked[5] ? checkAll(5) : uncheckAll(5)">
          <div style="margin: 5px; background-color: #956248; color: white; padding: 3px;">ProdCopy</div>
        </th>
        <td mat-cell *matCellDef="let element" style="text-align: center;"> 
          <ng-container *ngIf="element[6]">
            <ng-container *ngIf="isModified(element[0],5)">
              <mat-button color="primary" (click)="check(element[0],5)">
                <mat-icon>calendar_month</mat-icon>
              </mat-button>
            </ng-container>
            <input type="checkbox" [(ngModel)]="element[6]" (change)="uncheck(element[0],5)">
          </ng-container>
          <ng-container *ngIf="!element[6]">
            <input type="checkbox" [(ngModel)]="element[6]" (change)="check(element[0],5)">   
          </ng-container>   
        </td>
      </ng-container>

      <ng-container matColumnDef="staging">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>
          <input type="checkbox" [(ngModel)]="one_checked[6]" (change)="one_checked[6] ? checkAll(6) : uncheckAll(6)">
          <div style="margin: 5px; background-color: #f5f334; color: white; padding: 3px;">Staging</div>
        </th>
        <td mat-cell *matCellDef="let element" style="text-align: center;"> 
          <ng-container *ngIf="element[7]">
            <ng-container *ngIf="isModified(element[0],6)">
            <mat-button color="primary" (click)="check(element[0],6)">
              <mat-icon>calendar_month</mat-icon>
            </mat-button>
          </ng-container>
            <input type="checkbox" [(ngModel)]="element[7]" (change)="uncheck(element[0],6)">
          </ng-container>
          <ng-container *ngIf="!element[7]">
            <input type="checkbox" [(ngModel)]="element[7]" (change)="check(element[0],6)">   
          </ng-container>    
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayed_columns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayed_columns;"></tr>

    </table>

  </mat-card-content>
  <br>
  <mat-card-footer>
      <mat-paginator [pageSizeOptions]="[10,20]" showFirstLastButtons></mat-paginator>
  </mat-card-footer>
</mat-card>